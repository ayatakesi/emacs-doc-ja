@c ===========================================================================
@c
@c This file was generated with po4a. Translate the source file.
@c
@c ===========================================================================
@c This is part of the Emacs manual.
@c Copyright (C) 1985--1987, 1993--1995, 1997, 2000--2021 Free Software
@c Foundation, Inc.
@c See file emacs-ja.texi for copying conditions.
@node Packages
@chapter Emacs Lispパッケージ
@cindex Package
@cindex Package archive

  EmacsはEmacs
Lispライブラリーである@dfn{パッケージ(packages)}で追加機能を実装することにより拡張可能です。これらは自分で記述することも、他の人が提供することもあります。そのようなパッケージを将来のEmacsセッションで利用できるようにインストールしたい場合には、それらをコンパイルしてEmacsがLispライブラリーを探すディレクトリーに配置する必要があります。手動によるインストール手法の詳細は@ref{Lisp
Libraries}を参照してください。多くのパッケージにはLispファイルの先頭付近にインストールと使用方法の手順が大きくコメントされています。パッケージのインストールと使用方法の微調整にこれらの手順を使用できます。

@cindex Emacs Lisp package archive
  パッケージは巨大なEmacs Lispパッケージのコレクションである@dfn{パッケージアーカイブ(package
archives)}から提供されることもあります。それぞれのパッケージは個別のEmacs
Lispプログラムと、Infoマニュアルのような別のコンポーネントを含むこともあります。Emacsにはそのようなアーカイブから簡単にパッケージをダウンロードしてインストールする機能が含まれています。このチャプターの残りの部分ではその機能について説明します。

  パッケージアーカイブからのインストールで利用可能なパッケージをリストするには@w{@kbd{M-x list-packages
@key{RET}}}とタイプします。@kbd{M-x
list-packages}により、すべてのパッケージのリストを含む、@file{*Packages*}という名前のバッファーが表示されます。このバッファーを通じてパッケージをインストールしたりアンインストールできます。@ref{Package
Menu}を参照してください。

  コマンド@kbd{C-h P}
(@code{describe-package})はパッケージ名の入力を求め、そのパッケージの属性や、実装する機能を説明するヘルプバッファーを表示します。

  デフォルトでは、Emacsはemacs開発者により保守されGNUプロジェクトによりホスティングされるパッケージアーカイブからパッケージをダウンロードします。オプションでサードパーティーにより保守されるアーカイブから、パッケージをダウンロードすることもできます。@ref{Package
Installation}を参照してください。

  Emacs Lispのプログラムをインストール可能なパッケージに変更する情報に関しては、@ref{Packaging,,,elisp, The
Emacs Lisp Reference Manual}を参照してください。

@menu
* Package Menu::             パッケージを閲覧・管理するためのバッファー。
* Package Statuses::         パッケージが保有できるステータス。
* Package Installation::     パッケージのインストールにたいするオプション。
* Package Files::            パッケージがインストールされる場所。
@end menu

@node Package Menu
@section Package Menuバッファー
@cindex package menu
@cindex built-in package
@findex list-packages

コマンド@kbd{M-x list-packages}は、@dfn{パッケージメニュー(package
menu)}を立ち上げます。これはEmacsが把握するすべてのパッケージをリストするバッファーです。リストの各行には以下の情報が表示されます:

@itemize @bullet
@item
パッケージ名(例: @samp{auctex})。

@item
パッケージのバージョン番号(例: @samp{11.86})。

@item
@c @samp{unsigned} (installed, but not signed; @pxref{Package Signing}),
パッケージのステータスは通常は@samp{available}
(パッケージアーカイブからダウンロード可能)、@samp{installed}、@samp{built-in}
(デフォルトでEmacsに同梱)のいずれかです。@ref{Package Statuses}.<を参照してください。

@item
複数のパッケージアーカイブが有効ならそのパッケージがどのパッケージアーカイブのものか。

@item
パッケージの短い説明。
@end itemize

@noindent
@code{list-packages}は、パッケージアーカイブサーバーから利用可能なパッケージのリストを取得するために、ネットワークにアクセスします。ネットワークが利用できない場合、一番最近取得したリストにフォールバックします。

パッケージメニューでは、以下のコマンドが利用可能です:

@table @kbd
@item h
@kindex h @r{(Package Menu)}
@findex package-menu-quick-help
パッケージメニューの使い方を要約した短いメッセージを表示します(@code{package-menu-quick-help})。

@item ?
@itemx @key{RET}
@kindex ? @r{(Package Menu)}
@kindex RET @r{(Package Menu)}
@findex package-menu-describe-package
カレント行のパッケージにたいして、@kbd{C-h
P}コマンド(@ref{Packages}を参照してください)により表示されるヘルプウィンドウと同様の、ヘルプバッファーを表示します(@code{package-menu-describe-package})。

@item i
@kindex i @r{(Package Menu)}
@findex package-menu-mark-install
カレント行のパッケージをインストールのためにマークします(@code{package-menu-mark-install})。パッケージのステータスが@samp{available}の場合、行の先頭に文字@samp{I}を追加します。@kbd{x}とタイプすると、パッケージをダウンロードしてインストールします(以下参照)。

@item d
@kindex d @r{(Package Menu)}
@findex package-menu-mark-delete
カレント行のパッケージを削除のためにマークします(@code{package-menu-mark-delete})。パッケージのステータスが@samp{installed}の場合、行の先頭に文字@samp{D}を追加します。@kbd{x}とタイプすると、パッケージを削除します(以下参照)。パッケージ削除の結果、何が起こるかについての情報は、@ref{Package
Files}を参照してください。

@item emacs/mini-ja.texi.po
@kindex w @r{(Package Menu)}
@findex package-browse-url
カレント行にあるパッケージのホームページをブラウザでオープンします。ブラウザのオープンには@code{browse-url}を使用します。

@item ~
@kindex ~ @r{(Package Menu)}
@findex package-menu-mark-obsolete-for-deletion
削除のためにすべての時代遅れのパッケージobsolete
packagesをマークします(@code{package-menu-mark-obsolete-for-deletion})。これは状態が@samp{obsolete}の、すべてのパッケージを削除のためにマークします。

@item u
@itemx @key{DEL}
@kindex u @r{(Package Menu)}
@findex package-menu-mark-unmark
@kbd{i}や@kbd{d}コマンドによりカレント行に追加された、以前のインストールや削除マークを外します(@code{package-menu-mark-unmark})。

@item U
@kindex U @r{(Package Menu)}
@findex package-menu-mark-upgrades
新たに利用可能になったすべてのパッケージを、更新のためにマークします(@code{package-menu-mark-upgrades})。これは新たに利用可能になったバージョンにインストールのマークをつけ、インストール済みの古いバージョン(@samp{obsolete}のテータスにマークされている)に削除のマークをつけます。

@item x
@kindex x @r{(Package Menu)}
@vindex package-menu-async
@findex package-menu-execute
@kbd{i}でマークされたすべてのパッケージをダウンロードしてインストールするとともに、@kbd{d}でマークされたすべてのパッケージを削除します(@code{package-menu-execute})。これによりマークは削除されます。

@item g
@item r
@kindex g @r{(Package Menu)}
@kindex r @r{(Package Menu)}
パッケージリストを更新します(@code{revert-buffer})。これは再度パッケージアーカイブから利用可能なパッケージのリストを取得してパッケージリストを再表示します。

@item H
@kindex H @r{(Package Menu)}
@findex package-menu-hide-package
名前がregexpにマッチするパッケージを非表示にします(@code{package-menu-hide-package})。これはregexpの入力を求めて名前がマッチするパッケージを非表示にします。regexpのデフォルト値はポイント位置の名前のパッケージだけを非表示にするので、プロンプトで単に@key{RET}を押下するとカレントパッケージだけを非表示にします。

@item (
@kindex ( @r{(Package Menu)}
@findex package-menu-toggle-hiding
古いバージョンのパッケージ、および優先度低のアーカイブから取得したバージョンの可視性を切り替えます(@code{package-menu-toggle-hiding})。

@item / a
@kindex / a @r{(Package Menu)}
@findex package-menu-filter-by-archive
Filter package list by archive (@code{package-menu-filter-by-archive}).
This prompts for a package archive (e.g., @samp{gnu}), then shows only
packages from that archive.

@item / d
@kindex / d @r{(Package Menu)}
@findex package-menu-filter-by-description
Filter package list by description
(@code{package-menu-filter-by-description}).  This prompts for a regular
expression, then shows only packages with descriptions matching that regexp.

@item / k
@kindex / k @r{(Package Menu)}
@findex package-menu-filter-by-keyword
Filter package list by keyword (@code{package-menu-filter-by-keyword}).
This prompts for a keyword (e.g., @samp{games}), then shows only packages
with that keyword.

@item / N
@kindex / N @r{(Package Menu)}
@findex package-menu-filter-by-name-or-description
Filter package list by name or description
(@code{package-menu-filter-by-name-or-description}).  This prompts for a
regular expression, then shows only packages with a name or description
matching that regexp.

@item / n
@kindex / n @r{(Package Menu)}
@findex package-menu-filter-by-name
Filter package list by name (@code{package-menu-filter-by-name}).  This
prompts for a regular expression, then shows only packages with names
matching that regexp.

@item / s
@kindex / s @r{(Package Menu)}
@findex package-menu-filter-by-status
Filter package list by status (@code{package-menu-filter-by-status}).  This
prompts for one or more statuses (e.g., @samp{available}), then shows only
packages with matching status.

@item / v
@kindex / v @r{(Package Menu)}
@findex package-menu-filter-by-version
Filter package list by version (@code{package-menu-filter-by-version}).
This prompts first for one of the qualifiers @samp{<}, @samp{>} or @samp{=},
and then a package version, and shows packages that has a lower, equal or
higher version than the one specified.

@item / m
@kindex / m @r{(Package Menu)}
@findex package-menu-filter-marked
Filter package list by non-empty mark (@code{package-menu-filter-marked}).
This shows only the packages that have been marked to be installed or
deleted.

@item / u
@kindex / u @r{(Package Menu)}
@findex package-menu-filter-upgradable
利用可能なアップグレードがあるパッケージだけを表示するようにパッケージリストをフィルターします(@code{package-menu-filter-upgradable})。

@item / /
@kindex / / @r{(Package Menu)}
@findex package-menu-filter-clear
Clear filter currently applied to the package list
(@code{package-menu-filter-clear}).
@end table

@noindent
たとえばパッケージをインストールするには、そのパッケージの行で@kbd{i}をタイプしてから、@kbd{x}をタイプします。

@node Package Statuses
@section パッケージのステータス
@cindex package status

パッケージは以下のステータスのいずれかを保有できます:

@table @samp
@item available
パッケージは未インストールだがパッケージアーカイブからのダウンロードとインストールが可能。

@item avail-obso
インストールするためにパッケージは利用可能だが新たなバージョンも利用可能。このステータスのパッケージはデフォルトでは非表示。

@item built-in
パッケージはデフォルトでEmacsに同梱されている。これはパッケージメニューからは削除できずアップグレード対象とはみなされない。

@item dependency
別パッケージの依存関係を満足するために自動的にインストールされたパッケージ。

@item disabled
パッケージは@code{package-load-list}変数を使用して無効化された。

@item external
このパッケージはbuilt-inではなく、@code{package-user-dir}で指定されたディレクトリーのものではない(@ref{Package
Files}を参照)。外部パッケージは@samp{built-in}と同様に扱われて削除できない。

@item held
パッケージはheld(固定)されている。@ref{Package Installation}を参照のこと。

@item incompat
何らかの理由(たとえばインストール不可能なパッケージに依存)によりパッケージはインストール不能。

@item installed
パッケージはインストール済み。

@item new
@samp{available}と等価だが最後に@kbd{M-x
list-packages}を呼び出した後にパッケージがパッケージアーカイブで新たに利用可能になった点が異なる。

@item obsolete
パッケージはインストール済みの古いバージョン。パッケージの当該バージョンに加えて、新たなバージョンもインストール済み。

@c @samp{unsigned} (installed, but not signed; @pxref{Package Signing}),
@end table

@node Package Installation
@section パッケージのインストール

@findex package-install
  パッケージを一番便利にインストールするのはパッケージメニューを使う方法(@ref{Package
Menu}を参照してください)ですが、コマンド@kbd{M-x
package-install}を使用することもできます。これはステータスが@samp{available}のパッケージ名の入力を求め、それをダウンロードしてインストールします。

@cindex package requirements
  他のパッケージが提供する機能に依存するために、それらのパッケージがインストール済みであることを@dfn{必要(require)}とするパッケージもあるでしょう。Emacsがそのようなパッケージをインストールするときは、必要なパッケージがインストールされていなければ、それらのパッケージのダウンロードとインストールも自動に行ないます(必要なパッケージが何らかの理由で利用できない場合、Emacsはエラーをシグナルしてインストールを中止します)。パッケージの必要条件リスト(requirements
list)は、そのパッケージのヘルプバッファーに表示されます。

@vindex package-archives
  デフォルトでは、パッケージはEmacs開発者により保守される単一のパッケージアーカイブからダウンロードされます。これは変数@code{package-archives}により制御されます。この変数の値は、Emacsが認識するパッケージアーカイブのリストです。リストの各要素は@code{(@var{id}
.
@var{location})}という形式でなければなりません。ここで、@var{id}はパッケージアーカイブの名前、@var{location}はパッケージアーカイブディレクトリーの@acronym{URL}か名前です。サードパーティーのアーカイブを使用したい場合はこのリストを変更できます
--- が、自己責任で行い、信用できるサードパーティーだけを使用してください!

@anchor{Package Signing}
@cindex package security
@cindex package signing
  パッケージアーカイブのメンテナーは、パッケージに@dfn{サイン(signing)}を付して、信頼度を増すことができます。これらはプライベートとパブリックのペアーからなる暗号化キーにより生成されます。プライベートキーは各パッケージにたいする@dfn{署名ファイル(signature
file)}を作成するのに使用されます。パブリックキーにより、署名ファイルを使用してそのパッケージ作成者と、それが改ざんされていないかを確認できます。署名の検証は、EasyPGインターフェイス(@ref{Top,,
EasyPG, epa, Emacs EasyPG Assistant
Manual}を参照)を通じて@uref{https://www.gnupg.org/, the GnuPG
package}を使用します(@ref{Top,, EasyPG, epa, Emacs EasyPG Assistant
Manual}を参照)。有効な署名であっても、それが悪意がないパッケージであることを厳正に保証する訳ではなく、用心するべきです。パッケージアーカイブは、パブリックキーの入手方法について、説明を提供するべきです。@url{http://pgp.mit.edu/}のようなサーバーからキーをダウンロードするのも1つの方法です。Emacsにキーをインポートするには、@kbd{M-x
package-import-keyring}を使用します。Emacsは変数@code{package-user-dir}で指定されるディレクトリー(デフォルトは@code{package-gnupghome-dir}のサブディレクトリー@file{gnupg})にパッケージキーを格納します。これにより、Emacsが署名を検証する際に、オプション@file{gnupg}でGnuPGを呼び出すようになります。@code{package-gnupghome-dir}が@code{nil},の場合は、GnuPGのオプション@samp{--homedir}は省略します。GNUパッケージアーカイブにたいするパブリックキーはEmacsと共に配布され、@file{etc/package-keyring.gpg}にあります。Emacsはこれを自動的に使用します。

@vindex package-check-signature
@vindex package-unsigned-archives
  ユーザーオプション@code{package-check-signature}が非@code{nil}の場合、Emacsはパッケージのインストール時に署名の検証を試みます。このオプションが値@code{allow-unsigned}をもち、使用可能なOpenPGP設定が見つかったらサインされたパッケージはチェックされますが、未サインのパッケージもまだインストールができます。パッケージにサインしないアーカイブを使用する場合には、それらを@code{package-unsigned-archives}に追加できます(値が@code{allow-unsigned}で使用可能なOpenPGPが見つからなければこのオプションはあたかも値が@code{nil}であるかのように扱われる)。値が@code{t}なら少なくとも1つの署名が有効でなければならず、@code{all}ならすべての署名が有効でなければなりません。

  暗号化キーとサインについての詳細は、@ref{Top,, GnuPG, gnupg, The GNU Privacy Guard
Manual}を参照してください。EmacsのGNU Privacy Guardにたいするインターフェースについては、@ref{Top,,
EasyPG, epa, Emacs EasyPG Assistant Manual}を参照してください。

@vindex package-pinned-packages
  複数のパッケージアーカイブが有効で、同じパッケージにたいして異なるバージョンを提供する場合は、オプション@code{package-pinned-packages}が便利かもしれません。指定したパッケージが指定されたアーカイブだけからダウンロードされるように、このリストにパッケージとアーカイブのペアーを追加できます。

@vindex package-archive-priorities
@vindex package-menu-hide-low-priority
  複数の有効なパッケージアーカイブがあるときに便利な他のオプションとして、@code{package-archive-priorities}があります。これは各アーカイブにたいして、優先度(高い数字は高い優先度のアーカイブを指定します)を指定します。このオプションにより指定されない限り、アーカイブの優先度はデフォルトの0です。優先度高のアーカイブのパッケージが利用可能な場合、優先度低のアーカイブのパッケージはメニューに表示されません(これは@code{package-menu-hide-low-priority}の値により制御されます)。

  一度パッケージをダウンロードしてインストールすると、そのパッケージはカレントEmacsセッションで利用可能になります。
パッケージを利用可能にするにはパッケージのディレクトリーを@code{load-path}に追加してパッケージのautoloadをロードします。パッケージのautoloadの効果はパッケージごとにさまざまです。ほとんどのパッケージは、いくつかの新たなコマンドを利用可能にするだけですが、Emacsセッションにたいして広範な影響を及ぼすものもあります。この種の情報についてはパッケージのヘルプバッファーを参照してください。

  Installed packages are automatically made available by Emacs in all
subsequent sessions.  This happens at startup, before processing the init
file but after processing the early init file (@pxref{Early Init File}).  As
an exception, Emacs does not make packages available at startup if invoked
with the @samp{-q} or @samp{--no-init-file} options (@pxref{Initial
Options}).

@vindex package-enable-at-startup
  スタートアップ時にEmacsが自動的にパッケージを利用可能しないようにするためには変数@code{package-enable-at-startup}を@code{nil}に変更してください。この変数は正規のinitファイル(regular
init file)のロード前に読み込まれるので早期initファイル(early init
file)で行うようにしてください。現在のところこの変数はCustomizeを通じてセットできません。

@findex package-quickstart-refresh
@vindex package-quickstart
  If you have many packages installed, you can improve startup times by
setting the user option @code{package-quickstart} to @code{t}.  Setting this
option will make Emacs precompute many things instead of re-computing them
on every Emacs startup.  However, if you do this, then you have to manually
run the command @code{package-quickstart-refresh} when the activations need
to be changed, such as when you change the value of
@code{package-load-list}.

@findex package-activate-all
  @code{package-enable-at-startup}を@code{nil}にセットしてもスタートアップ中およびスタートアップじにパッケージを利用可能にすることはできます。インストール済みパッケージをスタートアップ中に利用可能にするにはinitファイル内で関数@code{package-activate-all}を呼び出し手ください。スタートアップ後に利用可能にするにはコマンド@kbd{M-:
(package-activate-all) RET}を呼び出してください。

@vindex package-load-list
  スタートアップ時に利用可能になるようにパッケージのロードをより精密に制御するために、変数@code{package-load-list}を使用することができます。この変数の値にはリストを指定します。@w{@code{(@var{name}
@var{version})}}という形式のリスト要素は、@var{name}という名前のパッケージのバージョン@var{version}を利用可能にするように指示します。ここで@var{version}には、(そのパッケージの特定のバージョンに対応する)バージョン文字列、@code{t}
(任意のインストール済みのバージョンを意味する)、または@code{nil}
(バージョンを意味しない。パッケージを利用可能にすることを抑止してパッケージを無効にする)を指定します。リストの要素にはシンボル@code{all}も指定でき、これは他のリスト要素で名前指定されていない任意のパッケージのインストール済みバージョンを利用可能にすることを意味します。デフォルト値は単に@code{'(all)}となっています。

  たとえば@code{package-load-list}を@code{'((muse "3.20")
all)}にセットするとEmacsは@samp{muse}のバージョン3.20のみ、および@samp{muse}以外のパッケージのインストール済みの任意のバージョンをロードします。@samp{muse}の他のバージョンがインストールされていたとしてもそれらは無視されます。@samp{muse}パッケージは@samp{held}というステータスでパッケージメニューにリストされるはずです。

@node Package Files
@section パッケージのファイルとディレクトリー
@cindex package directory

@cindex package file
@findex package-install-file
  各パッケージはパッケージアーカイブから単一ファイル形式 －－－ 1つのEmacs Lispソースファイル、または複数のEmacs
Lispソースと他のファイルを含むtarファイル ---
でダウンロードされます。パッケージファイルは、パッケージをインストールするEmacsコマンドにより自動的に取得、処理、配置されます。パッケージを作成する(@ref{Packaging,,,elisp,
The Emacs Lisp Reference
Manual}を参照してください)のでない限り、通常これらを直接扱う必要はないでしょう。パッケージファイルから直接パッケージをインストールする必要があるときは、コマンド@kbd{M-x
package-install-file}を使用してください。

@vindex package-user-dir
  1度インストールされると、パッケージの内容はそのサブディレクトリーに配置されます(変数@code{package-user-dir}を変更することにより、ディレクトリーの名前を変更できます)。パッケージのサブディレクトリーは@file{@var{name}-@var{version}}という名前で、@var{name}はパッケージ名、@var{version}はバージョン文字列です。

@cindex system-wide packages
@vindex package-directory-list
  @code{package-user-dir}に加えて、Emacsは@code{package-directory-list}にリストされたディレクトリーからインストール済みパッケージを探します。これらのディレクトリーはシステム管理者のためのディレクトリーで、Emacsパッケージをシステムワイドに利用可能にするためのものです。Emacs自身がこれらのディレクトリーにパッケージをインストールすることはありません。@code{package-directory-list}にたいするパッケージのサブディレクトリーは、@code{package-user-dir}と同じ方法で配置されます。

  パッケージの削除(@ref{Package
Menu}を参照してください)は、対応するパッケージのサブディレクトリーを削除します。これは@code{package-user-dir}にインストールされたパッケージだけに機能します。システムワイドなパッケージディレクトリーにたいして呼び出された場合、削除コマンドはエラーをシグナルします。
